<span class="page_title">Comments Manager</span>
<br />
{if $mode == '' || $mode == "list_comments"}
<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td width="40" align="center" valign="middle" class="left_head">
    <input type="checkbox" name="checkall" onclick="checkUncheckAll(this);"/></td>
    <td width="50" class="head">CID</td>
    <td class="head">Comment</td>
    <td width="50" class="right_head">&nbsp;</td>
  </tr>
</table>
<div style="clear:both; height:5px;"></div>
<a href="?filter=v" title="View Video Comments">View Video Comments</a> | <a href="?filter=t">View Topic Posts</a> | <a href="?filter=c">View Channel Comments</a>
{if $comments}
<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
{foreach from=$comments item=comment}

{if $comment.anonym_name != ""}
	{assign var=comment_owner value=$comment.anonym_name}
{else}
	{assign var=comment_owner value=$userquery->get_user_details($comment.userid)}
{/if} 
 

<tr class="video_opt_td" id="comment_{$comment.comment_id}" style="background-color:{if $comment.spam_votes > 0} #ffd7d7{else}{$bgcolor}{/if}">
<td width="40" align="center" valign="top" class="video_opt_td"><input name="check_comments[]" type="checkbox" id="check_comments" value="{$comment.comment_id}" /></td>
<td width="50" align="left" valign="top" class="video_opt_td">{$comment.comment_id}</td>
<td valign="top"  class="video_opt_td" onmouseover="$('#comm_opt-{$comment.comment_id}').show()" onmouseout="$('#comm_opt-{$comment.comment_id}').hide()" >
 {if $filters == '' || $filters == 'v'}
<span class="vdo_sets">
 {if is_array($comment_owner)} <a href="{$userquery->profile_link($comment_owner)}"><strong>{$comment_owner.username}</strong></a> {else} <strong>{$comment_owner}</strong> {/if} commented on <strong>{$comment.date_added|date_format}</strong>  on a video named <span style="text-transform:none"><a href="{videoLink vdetails=$comment}" title="{$comment.title}">{$comment.title|truncate:40}</a></span>
</span> 

<div style="height:5px; clear:both;"></div>
<span style="font-size:11px;">{$comment.comment|truncate:150}</span><br />

<div id="comm_opt-{$comment.comment_id}" class="vid_opts" style="display:none">
<a href="{videoLink vdetails=$comment}#{if $comment.spam_votes > 0}spam_{/if}comment_{$comment.comment_id}" target="_blank">{lang code='view'} {lang code='comment'}</a> |
<a href="?mode=edit_comment&cid={$comment.comment_id}">{lang code='edit'|capitalize} {lang code='comment'}</a> |

<a href="#" id="spam_comment_{$comment.comment_id}" onclick="admin_spam_comment({$comment.comment_id}); return false;"{if $comment.spam_votes ==0}  style="display:inline"{else} style="display:none;"{/if}>Mark {lang code='spam'}</a> <a href="#" id="remove_spam_comment_{$comment.comment_id}"  onclick="admin_remove_spam({$comment.comment_id}); return false;"
{if $comment.spam_votes !=0}  style="display:inline"{else} style="display:none;"{/if}>{lang code='remove'} {lang code='spam'}</a> | 

<a href="#" onclick="delete_comment('{$comment.comment_id}','v'); return false;">{lang code='delete'}</a>
</div>
</td>
<td width="50" valign="top" class="video_opt_td">&nbsp;</td>	
</tr>
{/if}

{if $filters == 't'}
<span class="vdo_sets">
 {if is_array($comment_owner)} <a href="{$userquery->profile_link($comment_owner)}"><strong>{$comment_owner.username}</strong></a> {else} <strong>{$comment_owner}</strong> {/if} commented on <strong>{$comment.date_added|date_format}</strong>  on a topic named <span style="text-transform:none"><a href="{$cbgroup->topic_link($comment)}" title="{$comment.topic_title}">{$comment.topic_title|truncate:40}</a></span>
</span> 
<div style="height:5px; clear:both;"></div>
<span style="font-size:11px;">{$comment.comment|truncate:150}</span><br />

<div id="comm_opt-{$comment.comment_id}" class="vid_opts" style="display:none">
<a href="{$cbgroup->topic_link($comment)}#{if $comment.spam_votes > 0}spam_{/if}comment_{$comment.comment_id}" target="_blank">{lang code='view'} {lang code='comment'}</a> |
<a href="?mode=edit_comment&cid={$comment.comment_id}">{lang code='edit'|capitalize} {lang code='comment'}</a> |

<a href="#" id="spam_comment_{$comment.comment_id}" onclick="admin_spam_comment({$comment.comment_id}); return false;"{if $comment.spam_votes ==0}  style="display:inline"{else} style="display:none;"{/if}>Mark {lang code='spam'}</a> <a href="#" id="remove_spam_comment_{$comment.comment_id}"  onclick="admin_remove_spam({$comment.comment_id}); return false;"
{if $comment.spam_votes !=0}  style="display:inline"{else} style="display:none;"{/if}>{lang code='remove'} {lang code='spam'}</a> | 

<a href="#" onclick="delete_comment('{$comment.comment_id}','v'); return false;">{lang code='delete'}</a>
</div>
{/if}

{if $filters == 'c'}
<span class="vdo_sets">
 {if is_array($comment_owner)} <a href="{$userquery->profile_link($comment_owner)}"><strong>{$comment_owner.username}</strong></a> {else} <strong>{$comment_owner}</strong> {/if} commented on <strong>{$comment.date_added|date_format}</strong>  on a channel named <span style="text-transform:none"><a href="{$userquery->profile_link($comment)}" title="{$comment.username}">{$comment.username|truncate:40}</a></span>
</span> 
<div style="height:5px; clear:both;"></div>
<span style="font-size:11px;">{$comment.comment|truncate:150}</span><br />

<div id="comm_opt-{$comment.comment_id}" class="vid_opts" style="display:none">
<a href="{$userquery->profile_link($comment)}#{if $comment.spam_votes > 0}spam_{/if}comment_{$comment.comment_id}" target="_blank">{lang code='view'} {lang code='comment'}</a> |
<a href="?mode=edit_comment&cid={$comment.comment_id}">{lang code='edit'|capitalize} {lang code='comment'}</a> |

<a href="#" id="spam_comment_{$comment.comment_id}" onclick="admin_spam_comment({$comment.comment_id}); return false;"{if $comment.spam_votes ==0}  style="display:inline"{else} style="display:none;"{/if}>Mark {lang code='spam'}</a> <a href="#" id="remove_spam_comment_{$comment.comment_id}"  onclick="admin_remove_spam({$comment.comment_id}); return false;"
{if $comment.spam_votes !=0}  style="display:inline"{else} style="display:none;"{/if}>{lang code='remove'} {lang code='spam'}</a> | 

<a href="#" onclick="delete_comment('{$comment.comment_id}','v'); return false;">{lang code='delete'}</a>
</div>
{/if}

{if $bgcolor == ""}
{assign var = bgcolor value = "#EEE"}
{else}
{assign var = bgcolor value = ""}
{/if}    
{/foreach}
</table>
{/if}

<div style="height:10px; clear:both"></div>
{include file="$style_dir/blocks/pagination.html" }
{/if}

{if $mode == 'edit_comment'}
{assign var=cid value=$smarty.get.cid}
{assign var=comment value=$cbvid->get_comment($cid)}
<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td width="5" valign="middle" class="left_head"></td>
    <td width="10" class="head">&nbsp;</td>
    <td class="head">Edit Comment</td>
    <td width="50" class="right_head">&nbsp;</td>
  </tr>
</table>
<div style="clear:both; height:5px;"></div>
<div></div>
<form action="" name="comment_moderation" id="comment_moderation" method="post">
	{ANCHOR place='before_compose_box'}
    <textarea name="comment" id="comment" style="padding:5px; font-size:11px; font-family:'Lucida Sans Unicode', 'Lucida Grande', sans-serif; background:#F0F0F0; border:1px solid #ccc; width:50%"rows="5" cols="45">{$comment.comment}</textarea>
    <div style="height:10px;"></div>
    <input type="submit" name="update_comment" id="update_comment" class="button"  value="Update Comment" />
</form>
{/if}